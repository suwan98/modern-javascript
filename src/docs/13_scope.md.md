# 13장 스코프

## 스코프란?

- 모든 식별자는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효범위가 결정된다.
- 스코프란 **식별자의 유효범위**

## 다음 코드는 어떻게 동작할까?

```js
var x = "global";

function foo() {
  var x = "local";
  console.log(x);
}

foo();
console.log(x);
```

- 자바스크립트 엔진은 foo 함수 내부 지역변수 x와 전역 변수 x 중 어떤 변수를 참조해야할 것인지를 결정한다.
  - 이를 **"식별자 결정"**이라 정의
- 따라서 스코프란 엔진이 **엔진이 식별자 검색 시 사용되는 규칙**이라고도 할 수 있다.
- 전역변수 x는 어디서는 참조할 수 있다. 그러나 foo 함수 내부 지역변수 x는 foo 함수 내부에서만 참조할 수 있다.
  - 이때, 두개의 x변수는 **식별자 이름이 동일하지만 스코프가 다른 별개의 변수**이다.

## 스코프의 종류

| 구분 | 설명                  | 스코프      | 변수      |
| ---- | --------------------- | ----------- | --------- |
| 전역 | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수 |
| 지역 | 함수 몸체 내부        | 지역 스코프 | 지역 변수 |

- 전역에서 선언된 변수는 **전역 스코프를 가지는 전역 변수**
- 지역에서 선언된 변수는 **지역 스코프를 가지는 지역 변수**

## 스코프 체인

**스코프는 함수의 중첩에 의해 계층적 구조를 가질 수 있다.**

- 스코프는 하나의 계층적 구조로 연결되며, 모든 지역 스코프의 최상위 스코프는 항상 전역 스코프를 가리킨다.
- 이렇게 스코프가 계층적으로 연결된것을 **스코프체인**이라 한다.

**변수 참조 시 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에 시작해 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.**

- 이를 통해 상위 스코프에서 선언된 변수를 하위 스코프에서도 참조가 가능한것

**엔진은 스코프체인을 따라 변수를 참조하는 코드의 스코프에 시작해, 상위스코프 방향으로 이동하며 선언된 변수를 검색하게 된다.**

- 절대 하위 스코프로 내려가며 식별자를 검색하는 일은 없다.
- 이는 상위 스코프에서 유효한 변수는 하위 스코프에서 자유로이 참조할 수 있으나, 하위스코프에서는 유효한 변수를 상위 스코프에서 참조할 수 없다는 것을 의미한다.

## 함수 레벨 스코프

**var 키워드로 선언된 변수는 오로지 함수의 코드블록만을 지역스코프로 인정한다**

- 이러한 특성을 **함수 레벨 스코프**라고 한다.
- 아래 코드에서 `global` 변수는 `var` 키워드로 선언되었다.
  - 함수 밖에서 `var`로 선언된 변수는 코드 블록 내 선언되었을 지라도 전역변수로 취급된다.
  - 따라서 if 문 내부에 있는 `global`도 전역변수이며, 최종적으로 `global`이 중복선언되었으며, 값또한 2로 변경되었다.

```js
/* 함수 레벨 스코프 */

var global = 1;

if (true) {
  var global = 2;
}

console.log(global); // 2
```

## 렉시컬 스코프

### 동적스코프

- 함수를 정의하는 시점에는 어디서 호출될 지 알수 없다. 따라서, 함수가 호출되는 시점에 동적으로 상위 스코프가 결정된다.

### 렉시컬 스코프

- 함수가 정의가 평가 되는 시점에 상위 스코프가 **정적**으로 결정된다.
- 따라서 정적 스코프라고도 불린다.
- 자바스크립트에서 렉시컬 스코프를 따른다

**자바스크립트에선 렉시컬 스코프를 따르므로 함수를 어디서 정의했는지에 따라 상위 스코프가 결정된다**

- 즉, 함수의 상위 스코프는 언제나 자신이 정의된 스코프이다.
- 함수 정의가 실행되어 생성된 함수 객체는 결정된 상위 스코프를 기억한다. (함수가 호출될 대마다 함수의 상위 스코프를 참조할 필요가 있기 때문!)

**아래 코드에서 bar 함수는 전역에서 정의된 함수 이다.**

- 함수 선언문으로 정의된 bar 함수는 전역코드가 실행되기 전 먼저 평가되어 함수객체를 생성한다.
  - 이때 생성된 bar 함수 객체는 전역스코프를 기억한다.
- 그리고 bar 함수 호출 시 어디인지 관계없이 언제나 자신이 기억하고 있는 전역스코프를 상위스코프로 사용한다.
  - 따라서 전역변수 x의 값을 두번 출력하게 된다.

```js
/* 렉시컬 스코프 예제 */

var x = 20;

function lexical() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x); // 20
}

lexical();
bar(); // 20
```
